<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="p-4">

<div class="container">
    <h2 class="mb-4 text-center">ðŸ“Š Predictions Dashboard</h2>

    <div class="card p-4 mb-4">
        <canvas id="lineChart" height="100"></canvas>
    </div>

    <div class="card p-4 mb-4">
        <canvas id="barChart" height="100"></canvas>
    </div>

    <div class="card p-4 mb-4">
        <h4 class="mb-3">Prediction Records</h4>
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Timestamp</th>
                        <th>Longitude</th>
                        <th>Latitude</th>
                        <th>Housing Age</th>
                        <th>Total Rooms</th>
                        <th>Total Bedrooms</th>
                        <th>Population</th>
                        <th>Households</th>
                        <th>Median Income</th>
                        <th>Ocean Proximity</th>
                        <th>Model Used</th>
                        <th>Predicted Value</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in rows %}
                    <tr>
                        {% for item in row[:-2] %}
                        <td>{{ item }}</td>
                        {% endfor %}
                        <td>{{ row[-2] }}</td>
                        <td>${{ row[-1] }}</td>
                        <td>
                            <form action="{{ url_for('delete', id=row[0]) }}" method="POST">
                                <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <nav aria-label="Page navigation" class="mt-3">
            <ul class="pagination justify-content-center">
                {% for p in range(1, total_pages+1) %}
                <li class="page-item {% if p == page %}active{% endif %}">
                    <a class="page-link" href="{{ url_for('dashboard') }}?page={{p}}&per_page=10">{{p}}</a>
                </li>
                {% endfor %}
            </ul>
        </nav>
    </div>
</div>

<script>
const chartTimes = {{ chart_times|tojson }};
const chartPreds = {{ chart_preds|tojson }};
const proxLabels = {{ prox_labels|tojson }};
const proxValues = {{ prox_values|tojson }};

const ctxLine = document.getElementById('lineChart').getContext('2d');
new Chart(ctxLine, {
    type: 'line',
    data: {
        labels: chartTimes,
        datasets: [{
            label: 'Predicted Value',
            data: chartPreds,
            borderColor: '#0d6efd',
            backgroundColor: 'rgba(13, 110, 253, 0.2)',
            tension: 0.3,
            fill: true,
        }]
    },
    options: {
        responsive: true,
        plugins: { legend: { display: true } },
        scales: { x: { display: true }, y: { beginAtZero: true } }
    }
});

const ctxBar = document.getElementById('barChart').getContext('2d');
new Chart(ctxBar, {
    type: 'bar',
    data: {
        labels: proxLabels,
        datasets: [{
            label: 'Ocean Proximity Counts',
            data: proxValues,
            backgroundColor: '#0d6efd'
        }]
    },
    options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
    }
});
</script>

</body>
</html>
